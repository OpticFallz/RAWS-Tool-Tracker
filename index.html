<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RAWS Tools Tracker</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState, useRef, useEffect} = React;

// Firebase Configuration - YOU NEED TO REPLACE THIS
  const firebaseConfig = {
    apiKey: "AIzaSyCaWp7eMxsBN--ruRoRUZsrtYI9vspPDhw",
    authDomain: "raws-tool-tracker.firebaseapp.com",
    databaseURL: "https://console.firebase.google.com/u/0/project/raws-tool-tracker/database/raws-tool-tracker-default-rtdb/data/~2F",
    projectId: "raws-tool-tracker",
    storageBucket: "raws-tool-tracker.firebasestorage.app",
    messagingSenderId: "165597406752",
    appId: "1:165597406752:web:6ea2b825ab9f07895f7e45",
    measurementId: "G-ZB100K429L"
  };

// Initialize Firebase
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
const database = firebase.database();

function App() {
  const [user, setUser] = useState(null);
  const [tools, setTools] = useState([]);
  const [login, setLogin] = useState({username: '', password: ''});
  const [showAddModal, setShowAddModal] = useState(false);
  const [newTool, setNewTool] = useState({name: '', category: 'Power Tools', image: null});
  const [showEditModal, setShowEditModal] = useState(false);
  const [editingTool, setEditingTool] = useState(null);
  const [openMenuId, setOpenMenuId] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterCategory, setFilterCategory] = useState('all');
  const [filterStatus, setFilterStatus] = useState('all');
  const [showCamera, setShowCamera] = useState(false);
  const [stream, setStream] = useState(null);
  const [cameraMode, setCameraMode] = useState(null);
  const [loading, setLoading] = useState(true);
  
  const fileInputRef = useRef(null);
  const videoRef = useRef(null);

  // Load tools from Firebase
  useEffect(() => {
    const toolsRef = database.ref('tools');
    toolsRef.on('value', (snapshot) => {
      const data = snapshot.val();
      if (data) {
        const toolsArray = Object.keys(data).map(key => ({
          id: key,
          ...data[key]
        }));
        setTools(toolsArray);
      } else {
        setTools([]);
      }
      setLoading(false);
    });

    return () => toolsRef.off();
  }, []);

  const addToolToFirebase = (tool) => {
    const newToolRef = database.ref('tools').push();
    newToolRef.set({
      ...tool,
      id: newToolRef.key
    });
  };

  const updateToolInFirebase = (toolId, updatedData) => {
    database.ref(`tools/${toolId}`).update(updatedData);
  };

  const deleteToolFromFirebase = (toolId) => {
    database.ref(`tools/${toolId}`).remove();
  };

  const startCamera = async (mode) => {
    try {
      const mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
      if (videoRef.current) {
        videoRef.current.srcObject = mediaStream;
      }
      setStream(mediaStream);
      setShowCamera(true);
      setCameraMode(mode);
    } catch (err) {
      alert('Camera access denied or unavailable');
    }
  };

  const capturePhoto = () => {
    const video = videoRef.current;
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);
    const imageData = canvas.toDataURL('image/jpeg', 0.7);
    
    if (cameraMode === 'edit') {
      setEditingTool({...editingTool, image: imageData});
    } else {
      setNewTool({...newTool, image: imageData});
    }
    stopCamera();
  };

  const stopCamera = () => {
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
      setStream(null);
    }
    setShowCamera(false);
    setCameraMode(null);
  };

  const handleImageUpload = (e, mode) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        if (mode === 'edit') {
          setEditingTool({...editingTool, image: reader.result});
        } else {
          setNewTool({...newTool, image: reader.result});
        }
      };
      reader.readAsDataURL(file);
    }
  };

  if (!user) {
    return (
      <div style={{minHeight: '100vh', background: '#0f172a', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px'}}>
        <div style={{background: '#1e293b', padding: '40px', borderRadius: '10px', maxWidth: '400px', width: '100%'}}>
          <h1 style={{color: '#f97316', fontSize: '32px', textAlign: 'center', marginBottom: '20px'}}>RAWS Tools Tracker</h1>
          <input 
            type="text" 
            placeholder="Username" 
            value={login.username}
            onChange={(e) => setLogin({...login, username: e.target.value})}
            style={{width: '100%', padding: '10px', marginBottom: '10px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
          />
          <input 
            type="password" 
            placeholder="Password"
            value={login.password}
            onChange={(e) => setLogin({...login, password: e.target.value})}
            style={{width: '100%', padding: '10px', marginBottom: '20px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
          />
          <button 
            onClick={() => {
              if (login.username === 'admin' && login.password === 'admin123') {
                setUser({name: 'Admin'});
              } else {
                alert('Invalid credentials. Try: admin / admin123');
              }
            }}
            style={{width: '100%', padding: '12px', background: '#f97316', color: 'white', border: 'none', borderRadius: '5px', fontSize: '16px', cursor: 'pointer'}}
          >
            Sign In
          </button>
          <p style={{color: '#94a3b8', marginTop: '20px', fontSize: '14px'}}>Demo: admin / admin123</p>
        </div>
      </div>
    );
  }

  if (loading) {
    return (
      <div style={{minHeight: '100vh', background: '#0f172a', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
        <p style={{color: 'white', fontSize: '20px'}}>Loading tools...</p>
      </div>
    );
  }

  const filteredTools = tools.filter(t => {
    const matchesSearch = t.name.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCategory = filterCategory === 'all' || t.category === filterCategory;
    const matchesStatus = filterStatus === 'all' || t.status === filterStatus;
    return matchesSearch && matchesCategory && matchesStatus;
  });
  
  return (
    <div style={{minHeight: '100vh', background: '#0f172a'}}>
      <div style={{background: '#1e293b', padding: '20px', borderBottom: '1px solid #334155'}}>
        <h1 style={{color: 'white', fontSize: '24px'}}>RAWS Tools Tracker</h1>
        <p style={{color: '#94a3b8', fontSize: '14px'}}>Welcome, {user.name}</p>
        <button onClick={() => setUser(null)} style={{marginTop: '10px', padding: '8px 16px', background: '#334155', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer'}}>
          Logout
        </button>
      </div>
      <div style={{padding: '20px'}}>
        <div style={{marginBottom: '20px', display: 'flex', gap: '10px', flexWrap: 'wrap', alignItems: 'center'}}>
          <input 
            type="text"
            placeholder="Search tools..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            style={{flex: '1', minWidth: '200px', padding: '10px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
          />
          <select 
            value={filterCategory}
            onChange={(e) => setFilterCategory(e.target.value)}
            style={{padding: '10px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
          >
            <option value="all">All Categories</option>
            <option value="Power Tools">Power Tools</option>
            <option value="Hand Tools">Hand Tools</option>
            <option value="Measuring Tools">Measuring Tools</option>
            <option value="Safety Equipment">Safety Equipment</option>
            <option value="Other">Other</option>
          </select>
          <select 
            value={filterStatus}
            onChange={(e) => setFilterStatus(e.target.value)}
            style={{padding: '10px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
          >
            <option value="all">All Status</option>
            <option value="available">Available</option>
            <option value="checked-out">Checked Out</option>
          </select>
          <button onClick={() => setShowAddModal(true)} style={{padding: '10px 20px', background: '#f97316', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer'}}>
            Add Tool
          </button>
        </div>

        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '20px'}}>
          {filteredTools.map(tool => (
            <div key={tool.id} style={{background: '#1e293b', padding: '20px', borderRadius: '10px', border: '1px solid #334155', position: 'relative'}}>
              <div style={{position: 'absolute', top: '10px', right: '10px'}}>
                <button onClick={() => setOpenMenuId(openMenuId === tool.id ? null : tool.id)} style={{background: '#334155', border: 'none', borderRadius: '5px', padding: '5px 10px', color: 'white', cursor: 'pointer'}}>
                  ‚ãÆ
                </button>
                {openMenuId === tool.id && (
                  <div style={{position: 'absolute', right: 0, marginTop: '5px', background: '#334155', borderRadius: '5px', border: '1px solid #475569', overflow: 'hidden', minWidth: '120px', zIndex: 10}}>
                    <button onClick={() => {
                      setEditingTool(tool);
                      setShowEditModal(true);
                      setOpenMenuId(null);
                    }} style={{width: '100%', padding: '10px', background: 'transparent', border: 'none', color: 'white', textAlign: 'left', cursor: 'pointer'}}>
                      ‚úèÔ∏è Edit
                    </button>
                    <button onClick={() => {
                      if (window.confirm('Delete this tool?')) {
                        deleteToolFromFirebase(tool.id);
                      }
                      setOpenMenuId(null);
                    }} style={{width: '100%', padding: '10px', background: 'transparent', border: 'none', color: '#ef4444', textAlign: 'left', cursor: 'pointer'}}>
                      üóëÔ∏è Delete
                    </button>
                  </div>
                )}
              </div>
              {tool.image && (
                <div style={{width: '100%', height: '200px', marginBottom: '15px', borderRadius: '8px', overflow: 'hidden', background: '#0f172a'}}>
                  <img src={tool.image} alt={tool.name} style={{width: '100%', height: '100%', objectFit: 'cover'}} />
                </div>
              )}
              <h3 style={{color: 'white', fontSize: '18px', marginBottom: '10px', paddingRight: '40px'}}>{tool.name}</h3>
              <p style={{color: '#94a3b8', fontSize: '14px', marginBottom: '10px'}}>{tool.category}</p>
              <div style={{display: 'inline-block', padding: '5px 15px', background: tool.status === 'available' ? '#065f46' : '#9a3412', color: tool.status === 'available' ? '#6ee7b7' : '#fdba74', borderRadius: '20px', fontSize: '14px'}}>
                {tool.status === 'available' ? 'Available' : 'Checked Out'}
              </div>
              <button onClick={() => {
                const updatedTool = {...tool};
                if (tool.status === 'available') {
                  updatedTool.status = 'checked-out';
                  updatedTool.holder = user.name;
                  updatedTool.history = [...(tool.history || []), {action: 'checked-out', user: user.name, time: new Date().toLocaleString()}];
                } else {
                  updatedTool.status = 'available';
                  updatedTool.holder = null;
                  updatedTool.history = [...(tool.history || []), {action: 'checked-in', user: user.name, time: new Date().toLocaleString()}];
                }
                updateToolInFirebase(tool.id, updatedTool);
              }} style={{width: '100%', marginTop: '15px', padding: '10px', background: tool.status === 'available' ? '#f97316' : '#16a34a', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer'}}>
                {tool.status === 'available' ? 'Check Out' : 'Check In'}
              </button>
              {tool.holder && (
                <p style={{color: '#94a3b8', fontSize: '14px', marginTop: '10px'}}>
                  üë§ Checked out by: {tool.holder}
                </p>
              )}
              {tool.history && tool.history.length > 0 && (
                <details style={{marginTop: '10px'}}>
                  <summary style={{color: '#94a3b8', fontSize: '14px', cursor: 'pointer'}}>üìã History ({tool.history.length})</summary>
                  <div style={{marginTop: '5px', maxHeight: '150px', overflowY: 'auto'}}>
                    {tool.history.slice(-10).reverse().map((h, i) => (
                      <div key={i} style={{padding: '5px', background: '#0f172a', borderRadius: '3px', marginBottom: '3px', fontSize: '12px', color: '#cbd5e1'}}>
                        <span style={{color: h.action === 'checked-out' ? '#fdba74' : '#6ee7b7'}}>
                          {h.action === 'checked-out' ? 'üì§' : 'üì•'} {h.action}
                        </span> by {h.user} - {h.time}
                      </div>
                    ))}
                  </div>
                </details>
              )}
            </div>
          ))}
        </div>
        {filteredTools.length === 0 && (
          <p style={{color: '#94a3b8', textAlign: 'center', marginTop: '40px'}}>No tools found!</p>
        )}
      </div>
      
      {showAddModal && (
        <div style={{position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.7)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px', zIndex: 1000}}>
          <div style={{background: '#1e293b', padding: '30px', borderRadius: '10px', maxWidth: '500px', width: '100%', border: '1px solid #334155', maxHeight: '90vh', overflowY: 'auto'}}>
            <h2 style={{color: 'white', fontSize: '24px', marginBottom: '20px'}}>Add New Tool</h2>
            <div style={{marginBottom: '15px'}}>
              <label style={{color: '#cbd5e1', fontSize: '14px', display: 'block', marginBottom: '5px'}}>Tool Name</label>
              <input 
                type="text" 
                value={newTool.name}
                onChange={(e) => setNewTool({...newTool, name: e.target.value})}
                style={{width: '100%', padding: '10px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
                placeholder="Enter tool name"
              />
            </div>
            <div style={{marginBottom: '15px'}}>
              <label style={{color: '#cbd5e1', fontSize: '14px', display: 'block', marginBottom: '5px'}}>Category</label>
              <select 
                value={newTool.category}
                onChange={(e) => setNewTool({...newTool, category: e.target.value})}
                style={{width: '100%', padding: '10px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
              >
                <option value="Power Tools">Power Tools</option>
                <option value="Hand Tools">Hand Tools</option>
                <option value="Measuring Tools">Measuring Tools</option>
                <option value="Safety Equipment">Safety Equipment</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div style={{marginBottom: '20px'}}>
              <label style={{color: '#cbd5e1', fontSize: '14px', display: 'block', marginBottom: '5px'}}>Tool Image</label>
              {newTool.image && (
                <div style={{width: '100%', height: '200px', marginBottom: '10px', borderRadius: '8px', overflow: 'hidden', background: '#0f172a'}}>
                  <img src={newTool.image} alt="Preview" style={{width: '100%', height: '100%', objectFit: 'cover'}} />
                </div>
              )}
              <div style={{display: 'flex', gap: '10px'}}>
                <button 
                  onClick={() => startCamera('add')}
                  style={{flex: 1, padding: '10px', background: '#334155', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer'}}
                >
                  üì∑ Camera
                </button>
                <button 
                  onClick={() => fileInputRef.current?.click()}
                  style={{flex: 1, padding: '10px', background: '#334155', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer'}}
                >
                  üìÅ Upload
                </button>
                <input 
                  ref={fileInputRef}
                  type="file"
                  accept="image/*"
                  onChange={(e) => handleImageUpload(e, 'add')}
                  style={{display: 'none'}}
                />
              </div>
            </div>
            <div style={{display: 'flex', gap: '10px'}}>
              <button 
                onClick={() => {
                  setShowAddModal(false);
                  setNewTool({name: '', category: 'Power Tools', image: null});
                }}
                style={{flex: 1, padding: '10px', background: '#334155', color: '#cbd5e1', border: 'none', borderRadius: '5px', cursor: 'pointer'}}
              >
                Cancel
              </button>
              <button 
                onClick={() => {
                  if (newTool.name.trim()) {
                    addToolToFirebase({
                      name: newTool.name,
                      category: newTool.category,
                      image: newTool.image,
                      status: 'available',
                      holder: null,
                      history: []
                    });
                    setNewTool({name: '', category: 'Power Tools', image: null});
                    setShowAddModal(false);
                  }
                }}
                style={{flex: 1, padding: '10px', background: '#f97316', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer'}}
              >
                Add Tool
              </button>
            </div>
          </div>
        </div>
      )}
      
      {showEditModal && editingTool && (
        <div style={{position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.7)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px', zIndex: 1000}}>
          <div style={{background: '#1e293b', padding: '30px', borderRadius: '10px', maxWidth: '500px', width: '100%', border: '1px solid #334155', maxHeight: '90vh', overflowY: 'auto'}}>
            <h2 style={{color: 'white', fontSize: '24px', marginBottom: '20px'}}>Edit Tool</h2>
            <div style={{marginBottom: '15px'}}>
              <label style={{color: '#cbd5e1', fontSize: '14px', display: 'block', marginBottom: '5px'}}>Tool Name</label>
              <input 
                type="text" 
                value={editingTool.name}
                onChange={(e) => setEditingTool({...editingTool, name: e.target.value})}
                style={{width: '100%', padding: '10px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
              />
            </div>
            <div style={{marginBottom: '15px'}}>
              <label style={{color: '#cbd5e1', fontSize: '14px', display: 'block', marginBottom: '5px'}}>Category</label>
              <select 
                value={editingTool.category}
                onChange={(e) => setEditingTool({...editingTool, category: e.target.value})}
                style={{width: '100%', padding: '10px', background: '#334155', border: '1px solid #475569', borderRadius: '5px', color: 'white'}}
              >
                <option value="Power Tools">Power Tools</option>
                <option value="Hand Tools">Hand Tools</option>
                <option value="Measuring Tools">Measuring Tools</option>
                <option value="Safety Equipment">Safety Equipment</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div style={{marginBottom: '20px'}}>
              <label style={{color: '#cbd5e1', fontSize: '14px', display: 'block', marginBottom: '5px'}}>Tool Image</label>
              {editingTool.image && (
                <div style={{width: '100%', height: '200px', marginBottom: '10px', borderRadius: '8px', overflow: 'hidden', background: '#0f172a'}}>
                  <img src={editingTool.image} alt="Preview" style={{width: '100%', height: '100%', objectFit: 'cover'}} />
                </div>
              )}
              <div style={{display: 'flex', gap: '10px'}}>
                <button 
                  onClick={() => startCamera('edit')}
                  style={{flex: 1, padding: '10px', background: '#334155', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer'}}
                >
                  üì∑ Camera
                </button>
                <button 
                  onClick={() => fileInputRef.current?.click()}
                  style={{flex: 1, padding: '10px', background: '#334155', color: 'white', border: '1px solid #475569', borderRadius: '5px', cursor: 'pointer'}}
                >
                  üìÅ Upload
                </button>
                <input 
                  ref={fileInputRef}
                  type="file"
                  accept="image/*"
                  onChange={(e) => handleImageUpload(e, 'edit')}
                  style={{display: 'none'}}
                />
              </div>
            </div>
            <div style={{display: 'flex', gap: '10px'}}>
              <button 
                onClick={() => {
                  setShowEditModal(false);
                  setEditingTool(null);
                }}
                style={{flex: 1, padding: '10px', background: '#334155', color: '#cbd5e1', border: 'none', borderRadius: '5px', cursor: 'pointer'}}
              >
                Cancel
              </button>
              <button 
                onClick={() => {
                  if (editingTool.name.trim()) {
                    updateToolInFirebase(editingTool.id, editingTool);
                    setShowEditModal(false);
                    setEditingTool(null);
                  }
                }}
                style={{flex: 1, padding: '10px', background: '#f97316', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer'}}
              >
                Save Changes
              </button>
            </div>
          </div>
        </div>
      )}

      {showCamera && (
        <div style={{position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.95)', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: '20px', zIndex: 2000}}>
          <video 
            ref={videoRef}
            autoPlay
            playsInline
            style={{width: '100%', maxWidth: '600px', borderRadius: '10px', marginBottom: '20px'}}
          />
          <div style={{display: 'flex', gap: '10px'}}>
            <button 
              onClick={stopCamera}
              style={{padding: '15px 30px', background: '#334155', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer', fontSize: '16px'}}
            >
              Cancel
            </button>
            <button 
              onClick={capturePhoto}
              style={{padding: '15px 30px', background: '#f97316', color: 'white', border: 'none', borderRadius: '5px', cursor: 'pointer', fontSize: '16px'}}
            >
              üì∏ Capture
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
